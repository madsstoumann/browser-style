<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CSP Manager - Custom Configuration</title>
	<link rel="stylesheet" href="/base.css">
	<script src="./src/index.js" type="module"></script>
	<style>
		section {
			margin-block: 3rem;
			padding-block-end: 2rem;
			border-bottom: 1px solid #ccc;
		}
		section:last-of-type {
			border-bottom: none;
		}
		.demo-controls {
			display: flex;
			gap: 1rem;
			margin-block: 1rem;
		}
		pre#output {
			background: #f5f5f5;
			padding: 1rem;
			border-radius: 0.5rem;
			min-height: 3rem;
			font-size: 0.875rem;
		}
	</style>
</head>
<body>
	<h1>CSP Manager - Custom Configuration</h1>
	<p>Examples demonstrating how to customize directives, translations, and evaluation rules.</p>

	<hr>

	<!-- Demo 1: Using HTML Attributes with Inline JSON -->
	<section>
		<h2>1. HTML Attributes (Inline JSON)</h2>
		<p>Custom directive added via inline JSON in the <code>directives</code> attribute.</p>

		<csp-manager
			id="demo1"
			lang="en"
			directives='{"report-uri": {"defaults": [], "type": "source-list", "enabled": false}}'
			i18n='{"en": {"directives": {"report-uri": "Deprecated. Use report-to instead."}}}'
			evaluate
		></csp-manager>
	</section>

	<!-- Demo 2: Using JavaScript Setters -->
	<section>
		<h2>2. JavaScript Setters</h2>
		<p>Click the buttons below to dynamically add custom configurations:</p>

		<p id="demo2-controls">
			<button id="addDirective">Add Custom Directive</button>
			<button id="addTranslation">Add Translation</button>
			<button id="addRule">Add Evaluation Rule</button>
			<button id="enableCustom">Enable Custom Directive</button>
		</p>

		<csp-manager id="demo2" lang="en" evaluate></csp-manager>

		<pre id="output"></pre>
	</section>

	<!-- Demo 3: Complete Example -->
	<section>
		<h2>3. Complete Custom Configuration</h2>
		<p>Shows a complete setup with a new directive, translation, and evaluation rule.</p>

		<p><button id="setupComplete">Setup Complete Configuration</button></p>

		<csp-manager id="demo3" lang="en" evaluate></csp-manager>
	</section>

	<script type="module">
		// Wait for custom elements to be defined
		await customElements.whenDefined('csp-manager');

		const demo2 = document.getElementById('demo2');
		const demo3 = document.getElementById('demo3');
		const output = document.getElementById('output');

		// Use event delegation for demo 2 buttons
		document.querySelector('#demo2-controls').addEventListener('click', (e) => {
			if (e.target.tagName !== 'BUTTON') return;

			const action = e.target.id;
			let message = '';

			switch (action) {
				case 'addDirective':
					demo2.setDirectivesConfig({
						'navigate-to': { defaults: ["'self'"], type: 'source-list', enabled: false }
					});
					message = 'Added "navigate-to" directive to the configuration.';
					break;
				case 'addTranslation':
					demo2.setI18nConfig({
						en: { directives: { 'navigate-to': 'Restricts URLs for navigation (experimental).' } }
					});
					message = 'Added translation for "navigate-to" directive.';
					break;
				case 'addRule':
					demo2.setRulesConfig({
						unsafeKeywords: {
							"'wasm-unsafe-eval'": { severity: 'medium', messageKey: 'eval.wasmWarning', recommendationKey: 'eval.wasmWarningRec' }
						}
					});
					demo2.setI18nConfig({
						en: { eval: { wasmWarning: 'Wasm-unsafe-eval allows WebAssembly compilation', wasmWarningRec: 'Only use if WebAssembly is required' } }
					});
					message = 'Added custom evaluation rule for "wasm-unsafe-eval".';
					break;
				case 'enableCustom':
					demo2.enableDirective('navigate-to');
					message = 'Enabled "navigate-to" directive in the UI.';
					break;
			}
			output.textContent = message;
		});

		// Demo 3: Complete setup
		document.getElementById('setupComplete').addEventListener('click', () => {
			demo3.setDirectivesConfig({
				'prefetch-src': { defaults: ["'self'"], type: 'source-list', enabled: true },
				'navigate-to': { defaults: ["'self'"], type: 'source-list', enabled: false }
			});
			demo3.setI18nConfig({
				en: {
					directives: {
						'prefetch-src': 'Specifies valid sources for prefetch and prerendering.',
						'navigate-to': 'Restricts URLs for navigation.'
					},
					eval: {
						prefetchWildcard: 'Wildcard in prefetch-src is risky',
						prefetchWildcardRec: 'Specify trusted origins for prefetch'
					}
				}
			});
			demo3.setRulesConfig({
				scriptStyleDirectives: ['prefetch-src'],
				criticalDirectives: {
					'form-action': { messageKey: 'eval.missingFormAction', recommendationKey: 'eval.missingFormActionRec' }
				}
			});
			demo3.setI18nConfig({
				en: {
					eval: {
						missingFormAction: 'Missing form-action allows form submissions to any URL',
						missingFormActionRec: 'Add form-action to restrict submissions'
					}
				}
			});
			console.log('Complete configuration applied!');
		});

		// Listen to changes
		demo2.addEventListener('csp-change', (e) => console.log('Demo 2 - Policy changed:', e.detail));
		demo3.addEventListener('csp-change', (e) => console.log('Demo 3 - Policy changed:', e.detail));
	</script>
</body>
</html>
