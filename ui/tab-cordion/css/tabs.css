/*
 ***************************************
 * TABS TRANSFORMATION (`to` attribute)
 ***************************************
 *
 * When the `to` attribute is present and the container is wide enough (>= 700px),
 * the component transforms into a tabbed interface. This section primarily handles
 * resetting the accordion styles from the `from` variants to a neutral state
 * before the main tab styles are applied.
 *
 */

tab-cordion {
	&[to] {
		@container (width >= 700px) {
			cq-box {
				background: unset;
				grid-template-columns: repeat(var(--tab-cordion-tabs, 6), 1fr);
				grid-template-rows: auto 1fr;
				isolation: isolate;
				padding: 0;
				position: relative;
				row-gap: 0;

				&::after {
					box-sizing: border-box;
					content: "";
					display: block;
					grid-row: 1;
					position: absolute;
					inset-block-start: var(--tc-tabs-bdw);
					inset-inline-start: calc(anchor(--tab-active left) + var(--tc-tabs-bdw));
					inline-size: calc(anchor-size(--tab-active width) - (2 * var(--tc-tabs-bdw)));
					block-size: calc(anchor-size(--tab-active height) - (2 * var(--tc-tabs-bdw)));
					transition: inset-inline-start var(--tc-item-trsdu) ease, inline-size var(--tc-item-trsdu) ease;
				}
			}

			details,
			details:first-of-type,
			details:last-of-type {
				border: 0;
				border-block-start: 0;
				border-radius: 0;
				box-shadow: none;
				display: grid;
				grid-column: 1 / -1;
				grid-row: 1 / span 2;
				grid-template-columns: subgrid;
				grid-template-rows: subgrid;
				pointer-events: none;
				translate: none;

				&[open] summary {
					anchor-name: --tab-active;
				}
			}

			details::details-content {
				font-size: var(--tc-panel-fs);
				grid-column: 1 / -1;
				grid-row: 2;
				pointer-events: auto;
			}

			details[open] summary + * {
				padding-block: var(--tc-tabs-panel-pb);
				padding-inline: var(--tc-tabs-panel-pi);
			}

			summary,
			details:first-of-type summary,
			details:last-of-type summary,
			details[open] + details summary,
			details:has(+ details[open]) summary {
				--tc-item-p: var(--tc-item-p-tabs);
				align-items: center;
				border-radius: 0;
				display: flex;
				gap: 1ch;
				justify-content: center;
				pointer-events: auto;
				text-align: center;
				transition: color var(--tc-item-trsdu), background-color var(--tc-item-trsdu);
				z-index: 1;

				& + * {
					pointer-events: auto;
					position: relative;
					z-index: 1;
				}
			}

			/* --- `background` --- */
			&[to~="background"] {
				cq-box::before {
					background: var(--tc-tabs-bg);
					content: "";
					grid-column: 1 / -1;
					grid-row: 1;
				}
				details {
					background: unset;
				}
			}

			/* --- `compact` --- */
			&[to~="compact"] {
				cq-box {
					column-gap: var(--tc-tabs-compact-cg, 2ch);
					grid-template-columns: repeat(calc(var(--tab-cordion-tabs, 6) - 1), min-content) auto;
				}
				details:last-of-type summary {
					justify-self: start;
				}
			}

			/* --- `highlight` --- */
			&[to~="highlight"] {
				cq-box::after {
					background: var(--tc-item-bg-active);
					border: var(--tc-tabs-item-bdw) solid var(--tc-tabs-item-bdc);
				}
			}

			/* --- `line` --- */
			&[to~="line"] {
				cq-box::after {
					--tc-tabs-bdw: 0px;
					border-block-end: var(--tc-tabs-line-bdw) solid var(--tc-accent);
				}
				summary {
					justify-self: center;
					padding-inline: 0;
				}
			}

			/* --- `noicons` --- */
			&[to~="noicons"] {
				summary ui-icon {
					display: none;
				}
			}

			/* --- `panel-bg` --- */
			&[to~="panel-bg"] {
				summary + * {
					background: var(--tc-tabs-panel-bg);
				}
			}

			/* --- `rounded` --- */
			&[to~="rounded"] {
				cq-box::before {
					border-radius: var(--tc-tabs-bdrs);
				}
				cq-box::after {
					border-radius: calc(var(--tc-tabs-bdrs) - var(--tc-tabs-bdw));
				}
				summary,
				details:first-of-type summary,
				details:last-of-type summary,
				details[open] + details summary,
				details:has(+ details[open]) summary {
					border-radius: var(--tc-tabs-bdrs);
				}
			}

			/* --- `shadow` --- */
			&[to~="shadow"] {
				summary + * {
					box-shadow: var(--tc-tabs-panel-bxsh);
				}
			}

			/* --- `contain` --- */
			&[to~="contain"] {
				cq-box {
					border: var(--tc-item-bdw) solid var(--tc-item-bdc);
				}
				details {
					padding-inline-start: var(--tc-tabs-panel-pi);

					&::details-content {
						padding-inline: 0 var(--tc-tabs-panel-pi);
					}
				}

				&[to~="rounded"] {
					cq-box {
						border-radius: var(--tc-tabs-container-bdrs);
					}
					&[to~="background"] cq-box::before {
						border-start-start-radius: var(--tc-tabs-container-bdrs);
						border-start-end-radius: var(--tc-tabs-container-bdrs);
						border-end-start-radius: 0;
						border-end-end-radius: 0;
					}
					&[to~="line"] cq-box::after {
						border-radius: 0;
					}
				}
			}

			@media (prefers-color-scheme: dark) {
				summary + * {
					--tc-tabs-panel-bxsh: var(--tc-tabs-panel-bxsh-dark);
				}
			}
		}
	}
}