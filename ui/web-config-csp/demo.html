<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Web Config CSP - Demos</title>
	<link rel="stylesheet" href="/base.css">
	<script type="importmap">
		{
			"imports": {
				"@browser.style/web-config-shared": "../web-config-shared/index.js"
			}
		}
	</script>
	<script src="./src/index.js" type="module"></script>
	<style>
		section {
			margin-block: 3rem;
			padding-block-end: 2rem;
			border-bottom: 1px solid #ccc;
		}
		section:last-of-type {
			border-bottom: none;
		}
		.demo-controls {
			display: flex;
			gap: 1rem;
			margin-block: 1rem;
		}
	</style>
</head>
<body>

	<h1>Web Config CSP Demos</h1>
	<p>Various examples demonstrating the Web Config CSP web component features.</p>

	<hr>

	<!-- Demo 1: Initial Policy with Evaluation -->
	<section>
		<h2>1. <code>initial-policy</code> with Evaluation</h2>
		<p>Initialize with a predefined policy and enable security evaluation (note the red borders on unsafe directives).</p>
		<div id="demo1-container"></div>
	</section>

	<!-- Demo 2: From String -->
	<section>
		<h2>2. <code>fromString()</code> Method</h2>
		<p>Parse a CSP string format and load it into the manager with evaluation enabled.</p>
		<div id="demo2-container"></div>
	</section>

	<!-- Demo 3: Get Policy and CSP String -->
	<section>
		<h2>3. <code>policy</code> and <code>cspString</code> Getters</h2>
		<p>Interact with the Web Config CSP below, then use the buttons to retrieve the current policy or copy the CSP string.</p>
		<web-config-csp id="demo3-manager" evaluate></web-config-csp>
		<div class="demo-controls">
			<button id="getPolicyBtn">Get Policy (Console)</button>
			<button id="getCspStringBtn">Copy CSP String to Clipboard</button>
		</div>
	</section>

	<!-- Demo 4: Danish Language with Multiple Severity Levels -->
	<section>
		<h2>4. <code>lang="da"</code> - Danish with Multiple Severity Levels</h2>
		<p>Eksempel på dansk sprog med forskellige sikkerhedsniveauer:</p>
		<ul>
			<li><strong>Høj (rød):</strong> script-src med 'unsafe-inline' og 'unsafe-eval'</li>
			<li><strong>Medium (orange):</strong> style-src med https: wildcard</li>
			<li><strong>Sikker (grøn):</strong> object-src og base-uri</li>
		</ul>
		<div id="demo4-container"></div>
	</section>

	<!-- Demo 5: Event Listener -->
	<section>
		<h2>5. <code>csp-change</code> Event Listener</h2>
		<p>Listen to changes and see the `csp-change` event details in the browser's developer console.</p>
		<p>Try adding or removing directives and values below, then check the console to see the event payload.</p>
		<web-config-csp id="demo5-manager" evaluate></web-config-csp>
	</section>

	<script type="module">
		// Helper function to create and configure a Web Config CSP instance
		function createDemoManager(containerId, options) {
			const container = document.getElementById(containerId);
			if (!container) return;

			const manager = document.createElement('web-config-csp');
			if (options.lang) manager.setAttribute('lang', options.lang);
			if (options.evaluate) manager.setAttribute('evaluate', '');
			if (options.initialPolicy) manager.setAttribute('initial-policy', JSON.stringify(options.initialPolicy));
			if (options.cspString) {
				customElements.whenDefined('web-config-csp').then(() => {
					manager.fromString(options.cspString);
				});
			}

			container.appendChild(manager);
			return manager;
		}

		// Demo 1: Initial Policy with Evaluation
		createDemoManager('demo1-container', {
			evaluate: true,
			initialPolicy: {
				"script-src": { "added": ["'unsafe-inline'", "cdn.example.com"] },
				"style-src": { "added": ["https://fonts.googleapis.com"] },
				"font-src": { "added": ["https://fonts.gstatic.com"] },
				"img-src": { "added": ["https://images.unsplash.com"] },
				"connect-src": { "added": ["api.example.com", "wss://websocket.example.com"] }
			}
		});

		// Demo 2: From String with Evaluation
		createDemoManager('demo2-container', {
			evaluate: true,
			cspString: `
				base-uri 'self';
				default-src 'self';
				frame-ancestors 'none';
				object-src 'none';
				script-src 'self' 'unsafe-inline' 'unsafe-eval' https://example.com;
				style-src 'self' 'unsafe-inline';
			`
		});

		// Demo 3: Policy and CSP String Getters
		const demo3Manager = document.getElementById('demo3-manager');
		document.getElementById('getPolicyBtn').addEventListener('click', () => {
			console.log('Current CSP Policy:', JSON.stringify(demo3Manager.policy, null, 2));
		});
		document.getElementById('getCspStringBtn').addEventListener('click', () => {
			const cspString = demo3Manager.cspString.replace(/&lt;/g, '<').replace(/&gt;/g, '>');
			navigator.clipboard.writeText(cspString).then(() => {
				alert('CSP string copied to clipboard!');
			}).catch(err => console.error('Failed to copy text: ', err));
		});

		// Demo 4: Danish with Multiple Severity Levels
		createDemoManager('demo4-container', {
			lang: 'da',
			evaluate: true,
			initialPolicy: {
				"base-uri": { "added": [] },
				"object-src": { "added": [] },
				"script-src": { "added": ["'unsafe-inline'", "'unsafe-eval'", "https://cdn.example.com"] },
				"style-src": { "added": ["https:", "'unsafe-inline'"] },
				"default-src": { "added": ["https:"] },
				"img-src": { "added": ["data:"] }
			}
		});

		// Demo 5: Event Listener
		const demo5Manager = document.getElementById('demo5-manager');
		demo5Manager.addEventListener('csp-change', (e) => {
			const timestamp = new Date().toLocaleTimeString();
			console.group(`[Web Config CSP] csp-change event at ${timestamp}`);
			console.log('Policy Object:', e.detail.policy);
			console.log('CSP String:', e.detail.cspString);
			if (e.detail.evaluations) {
				console.log('Evaluations:', e.detail.evaluations);
			}
			console.log('Full Event Detail:', e.detail);
			console.groupEnd();
		});
	</script>

</body>
</html>
