<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Drug Ticket</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Beregn din bøde for kørsel under påvirkning af stoffer">
	<style>
		body {
			font-family: system-ui;
			margin-inline: auto;
			max-width: 400px;
		}
		form {
			display: grid;
			gap: 1rem;
			padding: 1rem;
		}
		label, output {
			display: block;
		}
		fieldset[disabled] {
			opacity: 0.25;
		}
		[name=breakdown] {
			display: grid;
			grid-template-columns: 2fr 1fr;
			output {
				font-variant-numeric: tabular-nums;
				text-align: right;
			}
		}
	</style>
</head>
<body>

	<form id="app">
		<label for="income">Din månedlån før skat:</label>
		<output for="income" name="income_output">25.000 kr.</output>
		<input type="range" id="income" name="income" min="0" step="500" max="60000" value="25000">

		<fieldset>
			<legend>Vælg stof</legend>
			<label><input type="radio" name="drug" value="cannabis" checked>Cannabis</label>
			<label><input type="radio" name="drug" value="kokain">Kokain</label>
			<label><input type="radio" name="drug" value="lsd">LSD</label>
			<label><input type="radio" name="drug" value="ecstasy">Ecstasy (MDMA)</label>
			<label><input type="radio" name="drug" value="amfetamin">Amfetamin</label>
			<label><input type="radio" name="drug" value="opioider">Opioider</label>
			<label><input type="radio" name="drug" value="lattergas">Lattergas</label>
		</fieldset>

		<fieldset name="extra_info">
			<fieldset>
				<legend>THC-niveau i blodet / Lattergas i besiddelse</legend>
				<label><input type="radio" name="amount" value="low" checked>Lavt</label>
				<label><input type="radio" name="amount" value="medium">Mellem</label>
				<label><input type="radio" name="amount" value="high">Højt</label>
			</fieldset>	
			<label>
				Hvor lang tid har du haft kørekort?
				<input type="checkbox" name="license_years">
				<span>Under 3 år</span>
				<span>+3 år</span>
			</label>
		</fieldset>

		<details open>
			<summary>
				Ca. Total (kr) <output name="total">1500</output>
			</summary>

			<fieldset name="breakdown">
				<span>Bødestørrelse</span>
				<output name="fine">1500</output>
				<span>Analyse af blodprøve</span>
				<output name="blood_analysis_output">2700</output>
				<span>Udgift til læge</span>
				<output name="doctor_fee_output">125</output>
				<span>Offerfonden</span>
				<output name="victim_fund_output">500</output>
				<span>ANT-kursus</span>
				<output name="ant_course_output">3200</output>
				<span>Ny teori- og køreprøve</span>
				<output name="license_test_output">1210</output>
				<strong>Totale udgifter (ca.)</strong>
				<output name="total_fine"></output>
			</fieldset>
		</details>
	</form>

	<script>
		const app = document.getElementById('app');

		function calculate(elements) {

			/*=== CHECK IF CANABIS OR LATTERGAS, set to boolean ===*/
			
			/* disable extra info for non-cannabis/lattergas */
			elements.extra_info.disabled = elements.drug.value !== 'cannabis' && elements.drug.value !== 'lattergas';

			/* set fine based on salary */
			elements.fine.value = Math.round(((elements.income.value * 12) / 50) * (elements.drug.value === 'lattergas' ? 2 : 1));

			/* set fine multiplier based on drug and amount */
			const subtotal = [...elements.breakdown.elements].reduce((sum, elm) => sum + parseInt(elm.value || 0), 0);
			
			console.log(subtotal);
		
		}

		app.addEventListener('input', (event) => { calculate(app.elements) });
		calculate(app.elements);
	</script>
</body>
</html>