<!DOCTYPE html>
<html lang="da-DK" dir="ltr">
<head>
	<title>Number Scroller</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="">
	<style>

		b {
			background: hotpink;
			display: block;
			height: 100%;
			width: 2px;
		}
		fieldset {
			--scroller-width: 200%;
			border: 0;
			display: grid;
			font-family: ui-sans-serif, system-ui;
			
			margin: 0;
			padding: 0;
			text-align: center;
		}
		/* Range with scroller */
			label:has([type=range]) {
				grid-template-columns: 1fr;
				grid-template-rows: 1fr min-content;
				margin-block: .25rem;
				position: relative;
				row-gap: 1rem;
				&:has(:focus-visible) {
					outline: 1px solid #CCC;
					outline-offset: 4px;
				}
				&::after { /* GREEN SOLID LINE */
					background: cornflowerblue;
					border-radius: 3px;
					content: "";
					display: block;
					grid-area: 1 / 1;
					height: 32px;
					place-self: center;
					pointer-events: none;
					width: 5px;
					z-index: 1;
				}
				&::before { /* TRIANGLE */
					background: tomato;
					clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
					content: "";
					height: 5px;
					place-self: center;
					pointer-events: none;
					width: 10px;
				}
				input { grid-area: 1 / 1; margin: 0; }
				[data-scroll] {
					cursor: grab;
					display: block;
					grid-area: 1 / 1;
					inset: 0;
					mask: linear-gradient(to right, #0000, #000 15%, #000 85%, #0000);
					overflow-x: auto;
					position: absolute;
					scrollbar-width: none; /* Firefox */
					scroll-snap-type: x mandatory;

					[data-scroll-bg] {
						display: grid;
						grid-template-columns: 1fr 2fr 1fr;
						height: 100%;
						pointer-events: none;
						width: var(--scroller-width);
						/* &::after {
							background-image: url('range-bg.svg');
							background-size: 50px 30px;
							background-repeat: repeat-x;
							content: "";
							grid-column: 2;
						} */
					}
					[data-scroll-snap] {
						display: flex;
						grid-column: 2;
						justify-content: space-between;
						background: lime;
					}
				}
				[data-scroll]::-webkit-scrollbar {
					display: none; /* Safari and Chrome */
				}
			}
				[type=range],
	[type=range]::-webkit-slider-runnable-track,
	[type=range]::-webkit-slider-thumb {
		appearance: none;
	}
	</style>
</head>
<body>

	<fieldset data-snap-points="40">
		<legend class="label">Din månedsløn før skat:</legend>
		<output name="inc_out">25.000 kr.</output>
		<label aria-label="Vælg din månedsløn før skat">
			<input type="range" name="inc" min="0" step="500" max="100000" value="25000">
			<span data-scroll>
				<span data-scroll-bg>
					<span data-scroll-snap></span>
				</span>
			</span>
		</label>
	</fieldset>

	<script>
	(function() {
		/* --- INITIALIZATION & CACHING --- */
		const fieldset = document.querySelector('fieldset');
		const rangeInput = fieldset.querySelector('[name="inc"]');
		const output = fieldset.querySelector('[name="inc_out"]');
		const scroller = fieldset.querySelector('[data-scroll]');
		const snapContainer = fieldset.querySelector('[data-scroll-snap]');
		const snapPoints = parseInt(fieldset.dataset.snapPoints, 10);

		if (snapContainer && snapPoints) {
			for (let i = 0; i < snapPoints; i++) {
				const b = document.createElement('b');
				snapContainer.appendChild(b);
			}
		}

		// Cache constants for the range slider
		const incMin = parseFloat(rangeInput.min);
		const incMax = parseFloat(rangeInput.max);
		const incStep = parseFloat(rangeInput.step);
		const incRange = incMax - incMin;
		let scrollRange = scroller.scrollWidth - scroller.clientWidth;
		const locale = document.documentElement.lang || 'da-DK';


		/* --- UTILITIES --- */
		const formatNumber = (num) => parseInt(num).toLocaleString(locale);

		/* --- UPDATE FUNCTION --- */
		function updateFromInput() {
			const value = rangeInput.value;
			output.value = formatNumber(value) + ' kr.';
			const scrollPercentage = (value - incMin) / incRange;
			scroller.scrollLeft = scrollPercentage * scrollRange;
		}

		function updateFromScroll() {
			const scrollPercentage = scroller.scrollLeft / scrollRange;
			const scrollValue = incMin + (scrollPercentage * incRange);
			const steppedValue = Math.round(scrollValue / incStep) * incStep;
			output.value = formatNumber(steppedValue) + ' kr.';
		}
		
		function updateRangeFromScroll() {
			const scrollPercentage = scroller.scrollLeft / scrollRange;
			const scrollValue = incMin + (scrollPercentage * incRange);
			const steppedValue = Math.round(scrollValue / incStep) * incStep;
			rangeInput.value = steppedValue;
			// Do not call updateFromInput here to avoid scroll loop
		}

		/* --- EVENT HANDLING --- */
		fieldset.addEventListener('input', (e) => {
			if (e.target === rangeInput) {
				updateFromInput();
			}
		});

		scroller.addEventListener('scroll', updateFromScroll);
		scroller.addEventListener('scrollend', updateRangeFromScroll);

		/* --- RESIZE HANDLING --- */
		let resizeTimer;
		window.addEventListener('resize', () => {
			clearTimeout(resizeTimer);
			resizeTimer = setTimeout(() => {
				scrollRange = scroller.scrollWidth - scroller.clientWidth;
				updateFromInput();
			}, 250);
		});

		/* --- INITIAL UPDATE --- */
		updateFromInput();
	})();
	</script>

</body>
</html>