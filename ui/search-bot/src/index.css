/* ==========================================================================
   Search Bot (<search-bot>) Component Styles
   ========================================================================== */

:host * { box-sizing: border-box; }

:host {
	--sbot-gap: 12px;
	--sbot-bdc: light-dark(hsl(220 15% 85%), hsl(220 10% 50%));
	--sbot-overlay-backdrop: light-dark(hsl(220 15% 96% / 0.8), hsl(220 15% 10% / 0.9));
	--sbot-trigger-offset: 1rem;
	--sbot-conversation-mxw: 70ch;
	--sbot-hover-bg: light-dark(hsl(220 15% 88%), hsl(220 10% 18%));
	--sbot-chatbot-offset: 5rem;

	color-scheme: light dark;
	font-family: var(--sbot-ff, 'Iowan Old Style', 'Palatino Linotype', 'URW Palladio L', P052, serif);
	scrollbar-color: var(--sbot-scrollbar-thumb, light-dark(hsl(220 10% 75%), hsl(220 10% 30%))) var(--sbot-scrollbar-track, transparent);
	scrollbar-width: thin;
}

/* --- Trigger Button --- */

[part="search-trigger"] {
	display: grid;
}

:host(:not([position="inline"])) [part="search-trigger"] { position: fixed; }
:host([position*="top"]) [part="search-trigger"]    { inset-block-start: var(--sbot-trigger-offset); }
:host([position*="bottom"]) [part="search-trigger"] { inset-block-end: var(--sbot-trigger-offset); }
:host([position*="left"]) [part="search-trigger"]   { inset-inline-start: var(--sbot-trigger-offset); }
:host([position*="right"]) [part="search-trigger"]  { inset-inline-end: var(--sbot-trigger-offset); }

/* --- Overlay (Dialog) --- */

[part="search-overlay"] {
	background: var(--sbot-overlay-bg, #0000);
	border: 1px solid var(--sbot-bdc);
	block-size: 100%;
	container-type: inline-size;
	font-size: 1rem;
	inline-size: 100%;
	max-block-size: 100%;
	max-inline-size: 100%;
	padding: 0;
}

[part="search-overlay"][open] {
	align-content: start;
	display: grid;
}

[part="search-overlay"]::backdrop {
	background: var(--sbot-overlay-backdrop);
	backdrop-filter: var(--sbot-overlay-bdf, blur(20px) saturate(180%));
}

/* --- Header --- */

[part="search-header"] {
	background: var(--sbot-header-bg, #0000);
	border-block-end: 1px solid var(--sbot-bdc);
	display: flex;
	align-items: center;
	gap: calc(var(--sbot-gap) / 2);
	padding: var(--sbot-gap);
}

[part="search-history"] {
	anchor-name: --sbot-history;
}

[part="search-close"] {
	margin-inline-start: auto;
}

/* --- History Panel --- */

[part="search-history-panel"] {
	background: var(--sbot-history-bg, light-dark(hsl(220 15% 98% / 0.95), hsl(220 15% 14% / 0.95)));
	backdrop-filter: var(--sbot-history-bdf, blur(8px));
	border: 1px solid var(--sbot-bdc);
	border-radius: var(--sbot-history-bdrs, 0.5rem);
	box-shadow: var(--sbot-history-bxsh, light-dark(0 4px 12px hsl(220 15% 30% / 0.12), 0 4px 12px hsl(0 0% 0% / 0.3)));
	margin: 0;
	max-block-size: var(--sbot-history-mxbs, 60vh);
	max-inline-size: var(--sbot-history-mxis, 20rem);
	overflow-y: auto;
	padding: 0.5rem;
	position-anchor: --sbot-history;
	position-area: block-end span-inline-end;
}

[part="search-history-list"] {
	list-style: none;
	margin: 0;
	padding: 0;
}

[part="search-history-list"] li[data-key] {
	align-items: center;
	border-radius: 0.25rem;
	cursor: pointer;
	display: grid;
	gap: calc(var(--sbot-gap) / 2);
	grid-template-columns: 1fr auto;
	padding: calc(var(--sbot-gap) / 2) var(--sbot-gap);
}

[part="search-history-list"] li[data-key] span {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

[part="search-history-list"] li:hover {
	background: var(--sbot-hover-bg);
}

[part="search-history-list"] small {
	color: light-dark(hsl(220 10% 45%), hsl(220 10% 55%));
	display: block;
	font-size: 0.75em;
}

[part="search-history-delete"] {
	aspect-ratio: 1;
	background: light-dark(hsl(220 15% 88%), hsl(220 10% 22%));
	border: 0;
	border-radius: .25rem;
	cursor: pointer;
	display: inline-grid;
	place-content: center;
}

@media (hover: hover) {
	[part="search-history-delete"]:hover {
		background: light-dark(hsl(220 15% 78%), hsl(220 10% 32%));
	}
}

:host(:not([preserve-history])) [part="search-history"] {
	display: none;
}

/* --- Conversation Thread --- */

[part="search-conversation"] {
	flex: 1;
	list-style: none;
	margin: 0;
	overflow-y: auto;
	padding-block: var(--sbot-gap);
	padding-inline: max(var(--sbot-gap), calc(50% - var(--sbot-conversation-mxw) / 2));
}

[part="search-conversation"]:empty {
	display: none;
}

/* --- Messages --- */

[part="user"],
[part="response"] {
	padding: 0.75em 0;
}

[part="user"] {
	background-color: var(--sbot-user-bgc, light-dark(hsl(220 10% 90%), hsl(215 25% 22%)));
	border-radius: var(--sbot-user-bdrs, 0.75rem);
	justify-self: end;
	max-width: 80%;
	padding: var(--sbot-user-p, 0.625rem 1rem);
}

[part="response"] ul {
	display: grid;
	list-style: none;
	padding: 1em 0;
	row-gap: var(--sbot-response-ul-rg, 2ch);

	@container (min-width: 500px) {
		li a:has(img) { grid-template-columns: var(--sbot-response-img-is, auto) 1fr; }
	}

	li {
		display: contents;
		a {
			display: grid;
			column-gap: var(--sbot-gap);
			row-gap: calc(var(--sbot-gap) / 2);
			text-decoration: none;
			small, strong { display: block; }
			small { color: initial; }
			strong { text-decoration: underline; }
		}
	}
}

[part="response"] code {
	background: var(--sbot-code-bg, light-dark(hsl(220 15% 88%), hsl(220 10% 20%)));
	border-radius: 0.25em;
	font-family: var(--sbot-code-ff, monospace);
	padding: 0.1em 0.3em;
}

[part="response"] a {
	color: var(--sbot-link-c, light-dark(hsl(215 80% 40%), hsl(215 70% 65%)));
}

/* Typing indicator */
[part~="pending"]::before {
	animation: l3 1s infinite linear;
	aspect-ratio: 2;
	--_g: no-repeat radial-gradient(circle closest-side, currentColor 90%, #0000);
	background: var(--_g) 0% 50%, var(--_g) 50% 50%, var(--_g) 100% 50%;
	background-size: calc(100%/3) 50%;
	content: "";
	display: block;
	width: 45px;
}

@keyframes l3 {
	20%  { background-position: 0% 0%, 50% 50%, 100% 50% }
	40%  { background-position: 0% 100%, 50% 0%, 100% 50% }
	60%  { background-position: 0% 50%, 50% 100%, 100% 0% }
	80%  { background-position: 0% 50%, 50% 50%, 100% 100% }
}

/* --- Result Images --- */

[part="search-result-img"] {
	background-color: var(--sbot-img-bgc, light-dark(hsl(220 10% 90%), hsl(220 10% 20%)));
	display: block;
	max-inline-size: var(--sbot-img-mxis, 200px);
}

/* --- SVG Icon Buttons --- */

button[part]:has(svg) {
	aspect-ratio: 1;
	background: var(--sbot-btn-bg, light-dark(hsl(215 20% 90%), hsl(215 15% 22%)));
	border: 0;
	border-radius: 50%;
	display: inline-grid;
	place-items: center;
}

@media (hover: hover) {
	button[part]:has(svg):hover {
		background: var(--sbot-btn-bg-hover, light-dark(hsl(215 20% 82%), hsl(215 15% 30%)));
	}
}

/* --- Feedback Buttons --- */

[part="search-feedback"] {
	display: flex;
	gap: calc(var(--sbot-gap) / 2);
	padding-block-start: 0.5rem;
}

[part="search-feedback-like"],
[part="search-feedback-dislike"] {
	background: none;
	border: 1px solid var(--sbot-bdc);
	border-radius: 0.25rem;
	cursor: pointer;
	padding: 0.25rem;
}

[part="search-feedback-like"] svg,
[part="search-feedback-dislike"] svg {
	block-size: 1em;
	inline-size: 1em;
}

[part="search-feedback-like"]:hover,
[part="search-feedback-dislike"]:hover {
	background: var(--sbot-hover-bg);
}

/* --- Form & Input --- */

[part="search-form"] {
	bottom: 0;
	padding-block: var(--sbot-gap);
	padding-inline: max(var(--sbot-gap), calc(50% - var(--sbot-conversation-mxw) / 2));
	position: sticky;
}

[part="search-fieldset"] {
	all: unset;
	background: light-dark(Field, hsl(220 12% 15%));
	border: 1px solid var(--sbot-bdc);
	border-radius: var(--sbot-input-bdrs, 1ch);
	column-gap: var(--sbot-gap);
	display: grid;
	font: inherit;
	grid-template-columns: auto min-content;
	padding: var(--sbot-input-p, 1ch 2ch);
}

[part="search-legend"] {
	all: unset;
	text-align: center;
}

[part="search-input"] {
	background: transparent;
	border: 0;
	color: FieldText;
	font: inherit;
	outline: none;
	resize: none;
}

/* --- SVG Icons --- */

svg {
	block-size: var(--sbot-icon-sz, 2em);
	inline-size: var(--sbot-icon-sz, 2em);
}

[part="icon-stroke"] {
	fill: none;
	stroke: currentColor;
	stroke-width: 2;
	stroke-linecap: round;
	stroke-linejoin: round;
}

/* --- Chatbot Mode --- */

:host([mode="chatbot"]) [part="search-overlay"]::backdrop {
	background: transparent;
	backdrop-filter: none;
	pointer-events: none;
}

:host([mode="chatbot"]) [part="search-overlay"] {
	background: var(--sbot-overlay-backdrop);
	block-size: var(--sbot-chatbot-bs, min(600px, 80vh));
	inline-size: var(--sbot-chatbot-is, min(400px, 90vw));
	max-block-size: 80vh;
	max-inline-size: 90vw;
	border-radius: var(--sbot-chatbot-bdrs, 1rem);
	position: fixed;
	margin: 0;
	box-shadow: var(--sbot-chatbot-bxsh, light-dark(0 8px 32px hsl(220 15% 30% / 0.18), 0 8px 32px hsl(0 0% 0% / 0.4)));
}

:host([mode="chatbot"][position*="bottom"]) [part="search-overlay"] {
	inset-block-end: var(--sbot-chatbot-offset);
	inset-block-start: auto;
}

:host([mode="chatbot"][position*="top"]) [part="search-overlay"] {
	inset-block-start: var(--sbot-chatbot-offset);
	inset-block-end: auto;
}

:host([mode="chatbot"][position*="right"]) [part="search-overlay"] {
	inset-inline-end: 1rem;
	inset-inline-start: auto;
}

:host([mode="chatbot"][position*="left"]) [part="search-overlay"] {
	inset-inline-start: 1rem;
	inset-inline-end: auto;
}
