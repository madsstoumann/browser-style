/* ==========================================================================
   Search Bot (<search-bot>) Component Styles
   ========================================================================== */

/* --------------------------------------------------------------------------
   1. Host & Custom Properties
   -------------------------------------------------------------------------- */

:host * { box-sizing: border-box; }

:host {
	--sbot-ff: 'Iowan Old Style', 'Palatino Linotype', 'URW Palladio L', P052, serif;
	--sbot-gap: 12px;

	/* Trigger button */
	--sbot-trigger-bg: light-dark(hsl(215 20% 90%), hsl(215 15% 22%));
	--sbot-trigger-bdrs: 50%;
	--sbot-trigger-offset: 1rem;

	/* Overlay / dialog */
	/* --sbot-overlay-bg: light-dark(hsl(220 15% 96% / 0.8), hsl(220 15% 10% / 0.8)); */
	--sbot-overlay-bdf: blur(20px) saturate(180%);
	--sbot-overlay-bdc: light-dark(hsl(220 15% 85%), hsl(220 10% 20%));
	/* --sbot-overlay-backdrop: light-dark(hsl(220 10% 50% / 0.3), hsl(220 10% 5% / 0.5)); */
	--sbot-overlay-backdrop: light-dark(hsl(220 15% 96% / 0.8), hsl(220 15% 10% / 0.9));

	/* Header */
	--sbot-header-bg: light-dark(hsl(220 15% 97%), hsl(220 15% 13%));
	--sbot-bdc: light-dark(hsl(220 15% 85%), hsl(220 10% 50%));

	/* History panel */
	--sbot-history-bg: light-dark(hsl(220 15% 98% / 0.95), hsl(220 15% 14% / 0.95));
	--sbot-history-bdf: blur(8px);
	--sbot-history-bdc: light-dark(hsl(220 10% 82%), hsl(220 10% 22%));
	--sbot-history-bdrs: 0.5rem;
	--sbot-history-bxsh: light-dark(0 4px 12px hsl(220 15% 30% / 0.12), 0 4px 12px hsl(0 0% 0% / 0.3));
	--sbot-history-mxbs: 60vh;
	--sbot-history-mxis: 20rem;

	/* Conversation */
	--sbot-conversation-bg: light-dark(hsl(220 14% 96%), hsl(220 12% 11%));
	--sbot-conversation-mxw: 70ch;

	/* User message bubble */
	--sbot-user-bgc: light-dark(hsl(220 10% 90%), hsl(215 25% 22%));
	--sbot-user-bdrs: 0.75rem;
	--sbot-user-p: 0.625rem 1rem;

	/* Inline code */
	--sbot-code-bg: light-dark(hsl(220 15% 88%), hsl(220 10% 20%));
	--sbot-code-bdrs: 0.25em;
	--sbot-code-ff: monospace;

	/* Links */
	--sbot-link-c: light-dark(hsl(215 80% 40%), hsl(215 70% 65%));

	/* Form / input */
	--sbot-form-bg: light-dark(hsl(220 14% 96%), hsl(220 12% 11%));
	--sbot-input-bdrs: 1ch;
	--sbot-input-p: 1ch 2ch;

	/* Result images */
	--sbot-img-ar: 16/9;
	--sbot-img-bgc: light-dark(hsl(220 10% 90%), hsl(220 10% 20%));
	--sbot-img-mxis: 200px;

	/* SVG icon buttons */
	--sbot-icon-sz: 2em;
	--sbot-btn-icon-bg: light-dark(hsl(215 20% 90%), hsl(215 15% 22%));

	/* Feedback buttons */
	--sbot-feedback-bdc: light-dark(hsl(220 10% 82%), hsl(220 10% 25%));
	--sbot-feedback-bdrs: 0.25rem;

	/* Chatbot mode */
	--sbot-chatbot-bs: min(600px, 80vh);
	--sbot-chatbot-is: min(400px, 90vw);
	--sbot-chatbot-bdrs: 1rem;
	--sbot-chatbot-bxsh: light-dark(0 8px 32px hsl(220 15% 30% / 0.18), 0 8px 32px hsl(0 0% 0% / 0.4));
	--sbot-chatbot-offset: 5rem;

	/* Scrollbar */
	--sbot-scrollbar-thumb: light-dark(hsl(220 10% 75%), hsl(220 10% 30%));
	--sbot-scrollbar-track: transparent;

	/* Hover */
	--sbot-hover-bg: light-dark(hsl(220 15% 88%), hsl(220 10% 18%));

	color-scheme: light dark;
	font-family: var(--sbot-ff);
	scrollbar-color: var(--sbot-scrollbar-thumb) var(--sbot-scrollbar-track);
	scrollbar-width: thin;
}

/* --------------------------------------------------------------------------
   2. Trigger Button
   -------------------------------------------------------------------------- */

[part="search-trigger"] {
	aspect-ratio: 1;
	background: var(--sbot-trigger-bg);
	border: 0;
	border-radius: var(--sbot-trigger-bdrs);
	display: grid;
	place-items: center;
}

:host(:not([position="inline"])) [part="search-trigger"] { position: fixed; }
:host([position*="top"]) [part="search-trigger"]    { inset-block-start: var(--sbot-trigger-offset); }
:host([position*="bottom"]) [part="search-trigger"] { inset-block-end: var(--sbot-trigger-offset); }
:host([position*="left"]) [part="search-trigger"]   { inset-inline-start: var(--sbot-trigger-offset); }
:host([position*="right"]) [part="search-trigger"]  { inset-inline-end: var(--sbot-trigger-offset); }

/* --------------------------------------------------------------------------
   3. Search Overlay (Dialog)
   -------------------------------------------------------------------------- */

[part="search-overlay"] {
	background: var(--sbot-overlay-bg, #0000);
	border: 1px solid var(--sbot-overlay-bdc);
	block-size: 100%;
	container-type: inline-size;
	font-size: 1rem;
	inline-size: 100%;
	max-block-size: 100%;
	max-inline-size: 100%;
	padding: 0;
}

[part="search-overlay"][open] {
	align-content: start;
	display: grid;
}

[part="search-overlay"]::backdrop {
	background: var(--sbot-overlay-backdrop);
	backdrop-filter: var(--sbot-overlay-bdf);
	/* -webkit-backdrop-filter: var(--sbot-overlay-bdf); */
}

/* --------------------------------------------------------------------------
   4. Header
   -------------------------------------------------------------------------- */

[part="search-header"] {
	/* background: var(--sbot-header-bg); */
	border-block-end: 1px solid var(--sbot-bdc);
	display: flex;
	align-items: center;
	gap: calc(var(--sbot-gap) / 2);
	padding: var(--sbot-gap);
}

[part="search-close"] {
	margin-inline-start: auto;
}

/* --------------------------------------------------------------------------
   5. History Panel
   -------------------------------------------------------------------------- */

[part="search-history-panel"] {
	background: var(--sbot-history-bg);
	backdrop-filter: var(--sbot-history-bdf);
	border: 1px solid var(--sbot-history-bdc);
	border-radius: var(--sbot-history-bdrs);
	box-shadow: var(--sbot-history-bxsh);
	inset: auto;
	inset-block-start: 3.5rem;
	inset-inline-start: 1rem;
	margin: 0;
	max-block-size: var(--sbot-history-mxbs);
	max-inline-size: var(--sbot-history-mxis);
	overflow-y: auto;
	padding: 0.5rem;
}

[part="search-history-list"] {
	list-style: none;
	margin: 0;
	padding: 0;
}

[part="search-history-list"] li[data-key] {
	align-items: center;
	border-radius: 0.25rem;
	cursor: pointer;
	display: grid;
	grid-template-columns: 1fr auto;
	padding: 0.5rem 0.75rem;
}

[part="search-history-list"] li[data-key] span {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

[part="search-history-list"] li:hover {
	background: var(--sbot-hover-bg);
}

[part="search-history-list"] small {
	color: light-dark(hsl(220 10% 45%), hsl(220 10% 55%));
	display: block;
	font-size: 0.75em;
}

[part="search-history-delete"] {
	background: none;
	border: 0;
	cursor: pointer;
	font-size: 1em;
	grid-row: 1 / -1;
	opacity: 0.4;
	padding: 0.25rem;
}

[part="search-history-delete"]:hover {
	opacity: 1;
}

:host(:not([preserve-history])) [part="search-history"] {
	display: none;
}

/* --------------------------------------------------------------------------
   6. Conversation Thread
   -------------------------------------------------------------------------- */

[part="search-conversation"] {
	/* background: var(--sbot-conversation-bg); */
	flex: 1;
	list-style: none;
	margin: 0;
	overflow-y: auto;
	padding-block: var(--sbot-gap);
	padding-inline: max(var(--sbot-gap), calc(50% - var(--sbot-conversation-mxw) / 2));
}

[part="search-conversation"]:empty {
	display: none;
}

/* --------------------------------------------------------------------------
   7. Messages (User & Response)
   -------------------------------------------------------------------------- */

[part="user"],
[part="response"] {
	padding: 0.75em 0;
}

[part="user"] {
	background-color: var(--sbot-user-bgc);
	border-radius: var(--sbot-user-bdrs);
	justify-self: end;
	max-width: 80%;
	padding: var(--sbot-user-p);
}

[part="response"] ul {
	display: grid;
	list-style: none;
	padding: 1em 0;
	row-gap: var(--sbot-response-ul-rg, 2ch);

	@container (min-width: 500px) {
		li a:has(img) { grid-template-columns: var(--sbot-response-img-is, auto) 1fr; }
	}

	li {
		display: contents;
		a {
			display: grid;
			column-gap: var(--sbot-gap);
			row-gap: calc(var(--sbot-gap) / 2);
			text-decoration: none;
			small, strong { display: block; }
			small { color: initial; }
			strong { text-decoration: underline; }
		}
	}
}

[part="response"] code {
	background: var(--sbot-code-bg);
	border-radius: var(--sbot-code-bdrs);
	font-family: var(--sbot-code-ff);
	padding: 0.1em 0.3em;
}

[part="response"] a {
	color: var(--sbot-link-c);
}

/* Typing indicator */
[part~="pending"]::before {
	animation: l3 1s infinite linear;
	aspect-ratio: 2;
	--_g: no-repeat radial-gradient(circle closest-side, currentColor 90%, #0000);
	background: var(--_g) 0% 50%, var(--_g) 50% 50%, var(--_g) 100% 50%;
	background-size: calc(100%/3) 50%;
	content: "";
	display: block;
	width: 45px;
}

@keyframes l3 {
	20%  { background-position: 0% 0%, 50% 50%, 100% 50% }
	40%  { background-position: 0% 100%, 50% 0%, 100% 50% }
	60%  { background-position: 0% 50%, 50% 100%, 100% 0% }
	80%  { background-position: 0% 50%, 50% 50%, 100% 100% }
}

/* --------------------------------------------------------------------------
   8. Result Images
   -------------------------------------------------------------------------- */

[part="search-result-img"] {
	background-color: var(--sbot-img-bgc);
	display: block;
	max-inline-size: var(--sbot-img-mxis);
}

/* --------------------------------------------------------------------------
   SVG icon buttons
   -------------------------------------------------------------------------- */

button[part]:has(svg) {
	aspect-ratio: 1;
	background: var(--sbot-btn-icon-bg);
	border: 0;
	border-radius: 50%;
	display: inline-grid;
	place-items: center;
}

/* --------------------------------------------------------------------------
   9. Feedback Buttons
   -------------------------------------------------------------------------- */

[part="search-feedback"] {
	display: flex;
	gap: calc(var(--sbot-gap) / 2);
	padding-block-start: 0.5rem;
}

[part="search-feedback-like"],
[part="search-feedback-dislike"] {
	background: none;
	border: 1px solid var(--sbot-feedback-bdc);
	border-radius: var(--sbot-feedback-bdrs);
	cursor: pointer;
	padding: 0.25rem;
}

[part="search-feedback-like"] svg,
[part="search-feedback-dislike"] svg {
	block-size: 1em;
	inline-size: 1em;
}

[part="search-feedback-like"]:hover,
[part="search-feedback-dislike"]:hover {
	background: var(--sbot-hover-bg);
}

/* --------------------------------------------------------------------------
   10. Form & Input
   -------------------------------------------------------------------------- */

[part="search-form"] {
	/* background: var(--sbot-form-bg); */
	bottom: 0;
	padding-block: var(--sbot-gap);
	padding-inline: max(var(--sbot-gap), calc(50% - var(--sbot-conversation-mxw) / 2));
	position: sticky;
}

[part="search-fieldset"] {
	all: unset;
	background: light-dark(Field, hsl(220 12% 15%));
	border: 1px solid var(--sbot-overlay-bdc);
	border-radius: var(--sbot-input-bdrs);
	column-gap: var(--sbot-gap);
	display: grid;
	font: inherit;
	grid-template-columns: auto min-content;
	padding: var(--sbot-input-p);
}

[part="search-legend"] {
	all: unset;
	text-align: center;
}

[part="search-input"] {
	background: transparent;
	border: 0;
	color: FieldText;
	font: inherit;
	outline: none;
	resize: none;
}

/* --------------------------------------------------------------------------
   11. SVG Icons
   -------------------------------------------------------------------------- */

svg {
	block-size: var(--sbot-icon-sz);
	inline-size: var(--sbot-icon-sz);
}

[part="icon-stroke"] {
	fill: none;
	stroke: currentColor;
	stroke-width: 2;
	stroke-linecap: round;
	stroke-linejoin: round;
}

/* --------------------------------------------------------------------------
   12. Chatbot Mode
   -------------------------------------------------------------------------- */

:host([mode="chatbot"]) [part="search-overlay"]::backdrop {
	background: transparent;
	backdrop-filter: none;
	pointer-events: none;
}

:host([mode="chatbot"]) [part="search-overlay"] {
	background: var(--sbot-overlay-backdrop);
	block-size: var(--sbot-chatbot-bs);
	inline-size: var(--sbot-chatbot-is);
	max-block-size: 80vh;
	max-inline-size: 90vw;
	border-radius: var(--sbot-chatbot-bdrs);
	position: fixed;
	margin: 0;
	box-shadow: var(--sbot-chatbot-bxsh);
}

:host([mode="chatbot"][position*="bottom"]) [part="search-overlay"] {
	inset-block-end: var(--sbot-chatbot-offset);
	inset-block-start: auto;
}

:host([mode="chatbot"][position*="top"]) [part="search-overlay"] {
	inset-block-start: var(--sbot-chatbot-offset);
	inset-block-end: auto;
}

:host([mode="chatbot"][position*="right"]) [part="search-overlay"] {
	inset-inline-end: 1rem;
	inset-inline-start: auto;
}

:host([mode="chatbot"][position*="left"]) [part="search-overlay"] {
	inset-inline-start: 1rem;
	inset-inline-end: auto;
}
