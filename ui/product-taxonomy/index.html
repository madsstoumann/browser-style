<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Product Taxonomy</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Product Taxonomy Component - Search Google and Facebook product categories">
	<meta name="view-transition" content="same-origin">
	<link rel="stylesheet" href="/ui/base/index.css">
	<style>
		.schema-preview { margin-block-start: 1rem; }
		.schema-preview h4 { margin-block: 0.5rem 0.25rem; }
		.schema-preview pre { background: #f5f5f5; padding: 0.5rem; overflow-x: auto; font-size: 0.75rem; border-radius: 0.25rem; }
		.schema-boilerplate { color: #999; }
	</style>
</head>
<body>
	<h1>UI: Product Taxonomy (using Auto-Suggest)</h1>

	<p>
		This page demonstrates how to use the <code>&lt;auto-suggest&gt;</code> component
		to provide searchable product category selection from Google or Facebook taxonomies.
		The <code>createTaxonomySelector</code> factory function handles the data loading and parsing.
	</p>

	<h2>Examples</h2>

	<section>
		<h3>Google Product Taxonomy</h3>
		<p>Search for product categories like "headphones", "shoes", "furniture", etc.</p>

		<auto-suggest
			id="google-taxonomy"
			search-mode="local-keywords"
			search-fields="path"
			api-value-path="id"
			api-display-path="path"
			info-template="Loaded {count} categories"
			status-template="Selected: {display}"
			label="Google Product Category"
			list-mode="ul"
			minlength="2"
			placeholder="e.g., headphones, coffee, toys"
			noshadow
			required>
			<small slot="info"></small>
			<small slot="status"></small>
		</auto-suggest>
		<div class="schema-preview" id="google-schema-preview" hidden>
			<h4>Schema.org Microdata</h4><pre class="schema-microdata"></pre>
			<h4>Schema.org JSON-LD</h4><pre class="schema-jsonld"></pre>
		</div>
	</section>

	<section>
		<h3>Facebook Product Taxonomy</h3>
		<p>Search Facebook's product categories. Try "beverages", "toys", "furniture".</p>

		<auto-suggest
			id="facebook-taxonomy"
			search-mode="local-keywords"
			search-fields="path"
			api-value-path="id"
			api-display-path="path"
			info-template="Loaded {count} categories"
			status-template="Selected: {display}"
			label="Facebook Product Category"
			list-mode="ul"
			minlength="2"
			placeholder="e.g., food, games, clothing"
			noshadow>
			<small slot="info"></small>
			<small slot="status"></small>
		</auto-suggest>
		<div class="schema-preview" id="facebook-schema-preview" hidden>
			<h4>Schema.org JSON-LD</h4><pre class="schema-jsonld"></pre>
		</div>
	</section>

	<section>
		<h3>Google Product Taxonomy with Fuzzy Search</h3>
		<p>Fuzzy search with typo tolerance. Try typos like "coffe cups", "headphnes", "furnitur".</p>
		<p><strong>Features:</strong> Tolerates spelling mistakes, finds similar words, ranks by relevance.</p>

		<auto-suggest
			id="fuzzy-taxonomy"
			search-mode="local-fuzzy"
			search-fields="path"
			min-score="0.5"
			max-results="20"
			api-value-path="id"
			api-display-path="path"
			info-template="Loaded {count} categories"
			label="Fuzzy Product Search"
			list-mode="ul"
			minlength="3"
			placeholder="e.g., coffe, hphone, furnitur"
			status-template="Selected: {display}"
			noshadow>
			<small slot="info"></small>
			<small slot="status"></small>
		</auto-suggest>
	</section>

	<h2>Documentation</h2>
	<p>For full documentation, see the <a href="https://github.com/madsstoumann/browser-style/tree/main/ui/product-taxonomy">README</a>.</p>

	<script type="module">
		import { createTaxonomySelector } from './factory.js';
		import { googleTaxonomyParser, facebookTaxonomyParser } from './parsers.js';
		import { AutoSuggest } from '../auto-suggest/index.js';

		// --- Helper functions for Schema.org preview ---
		function escapeHtml(str) {
			return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
		}

		function generateMicrodata(item) {
			const categories = item.categories;
			const boilerplate = `<span class="schema-boilerplate">${escapeHtml('<div itemscope itemtype="https://schema.org/Product">')}\n  ${escapeHtml('<meta itemprop="name" content="Example Product">')}</span>\n`;
			let taxonomyHtml = `  ${escapeHtml('<div itemprop="category" itemscope itemtype="https://schema.org/DefinedTerm">')}\n`;
			taxonomyHtml += `    ${escapeHtml(`<meta itemprop="termCode" content="${item.id}">`)}\n`;
			taxonomyHtml += `    ${escapeHtml(`<meta itemprop="name" content="${item.name}">`)}\n`;
			if (categories.length > 1) {
				taxonomyHtml += `    ${escapeHtml('<div itemprop="inDefinedTermSet" itemscope itemtype="https://schema.org/DefinedTermSet">')}\n`;
				taxonomyHtml += `      ${escapeHtml(`<meta itemprop="name" content="${categories.slice(0, -1).join(' > ')}">`)}\n`;
				taxonomyHtml += `    ${escapeHtml('</div>')}\n`;
			}
			taxonomyHtml += `  ${escapeHtml('</div>')}\n`;
			taxonomyHtml += `<span class="schema-boilerplate">${escapeHtml('</div>')}</span>`;
			return boilerplate + taxonomyHtml;
		}

		function generateJsonLd(item) {
			const jsonld = {
				"@context": "https://schema.org",
				"@type": "Product",
				"name": "Example Product",
				"category": {
					"@type": "DefinedTerm",
					"termCode": item.id,
					"name": item.name,
					"inDefinedTermSet": {
						"@type": "DefinedTermSet",
						"name": "Product Taxonomy"
					},
					"additionalProperty": {
						"@type": "PropertyValue",
						"name": "categoryPath",
						"value": item.path
					}
				}
			};
			if (item.categories.length > 1) {
				jsonld.category.inDefinedTermSet.name = item.categories.slice(0, -1).join(' > ');
			}
			return JSON.stringify(jsonld, null, 2);
		}

		function updateSchemaPreview(previewEl, item) {
			if (!previewEl || !item) {
				if(previewEl) previewEl.hidden = true;
				return;
			}
			previewEl.hidden = false;
			const microdataEl = previewEl.querySelector('.schema-microdata');
			const jsonldEl = previewEl.querySelector('.schema-jsonld');

			if (microdataEl) microdataEl.innerHTML = generateMicrodata(item);
			if (jsonldEl) jsonldEl.textContent = generateJsonLd(item);
		}

		// --- Setup for each taxonomy instance ---
		async function setupTaxonomyComponent(id, dataUrl, parser, schemaPreviewId) {
			const autoSuggestEl = document.getElementById(id);
			if (!autoSuggestEl) return;

			await createTaxonomySelector(autoSuggestEl, { dataUrl, parser });

			const schemaPreviewEl = document.getElementById(schemaPreviewId);

			autoSuggestEl.addEventListener('autoSuggestSelect', (e) => {
				console.log(`${id} selected:`, e.detail);
				updateSchemaPreview(schemaPreviewEl, e.detail);
			});

			autoSuggestEl.addEventListener('autoSuggestClear', () => {
				console.log(`${id} cleared`);
				if (schemaPreviewEl) schemaPreviewEl.hidden = true;
			});
		}

		// Initialize all taxonomy components
		setupTaxonomyComponent('google-taxonomy', 'google.txt', googleTaxonomyParser, 'google-schema-preview');
		setupTaxonomyComponent('facebook-taxonomy', 'facebook.txt', facebookTaxonomyParser, 'facebook-schema-preview');
		setupTaxonomyComponent('fuzzy-taxonomy', 'google.txt', googleTaxonomyParser);

	</script>
</body>
</html>