<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Product Taxonomy</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Product Taxonomy Component - Search Google and Facebook product categories">
	<meta name="view-transition" content="same-origin">
	<link rel="stylesheet" href="/ui/base/index.css">
	<style>
		.demo-section {
			margin-block: 2rem;
			padding: 1rem;
			border: 1px solid #ccc;
			border-radius: 0.5rem;
		}
		.status {
			padding: 0.5rem;
			margin-block: 0.5rem;
			background: #f0f0f0;
			border-radius: 0.25rem;
			font-family: monospace;
			font-size: 0.875rem;
		}
		.selected-info {
			margin-block: 1rem;
			padding: 1rem;
			background: #e8f5e9;
			border-radius: 0.25rem;
		}
		.selected-info h4 {
			margin-block-start: 0;
		}
		.category-path {
			font-family: monospace;
			font-size: 0.875rem;
			color: #666;
		}
		.schema-boilerplate {
			color: #CCC;
		}
	</style>
</head>
<body>
	<h1>UI: Product Taxonomy</h1>

	<p>
		The <code>&lt;product-taxonomy&gt;</code> component integrates with <code>&lt;auto-suggest&gt;</code>
		to provide searchable product category selection from Google or Facebook taxonomies.
	</p>

	<h2>Examples</h2>

	<section class="demo-section">
		<h3>Google Product Taxonomy (Default)</h3>
		<p>Search for product categories like "headphones", "shoes", "furniture", etc.</p>

		<product-taxonomy
			id="google-taxonomy"
			mode="google"
			label="Google Product Category"
			list-mode="ul"
			placeholder="e.g., headphones, coffee, toys"
			noshadow
		></product-taxonomy>

		<div id="google-status" class="status">Ready to search...</div>
		<div id="google-selected" class="selected-info" style="display: none;">
			<h4>Selected Category:</h4>
			<p><strong>ID:</strong> <span class="category-id"></span></p>
			<p><strong>Name:</strong> <span class="category-name"></span></p>
			<p><strong>Full Path:</strong><br><span class="category-path"></span></p>

			<h4>Schema.org Microdata:</h4>
			<pre class="schema-microdata" style="background: #f5f5f5; padding: 0.5rem; overflow-x: auto; font-size: 0.75rem;"></pre>

			<h4>Schema.org JSON-LD:</h4>
			<pre class="schema-jsonld" style="background: #f5f5f5; padding: 0.5rem; overflow-x: auto; font-size: 0.75rem;"></pre>
		</div>
	</section>

	<section class="demo-section">
		<h3>Facebook Product Taxonomy</h3>
		<p>Search Facebook's product categories. Try "beverages", "toys", "furniture".</p>

		<product-taxonomy
			id="facebook-taxonomy"
			mode="facebook"
			label="Facebook Product Category"
			placeholder="e.g., food, games, clothing"
			list-mode="ul"
			noshadow
		></product-taxonomy>

		<div id="facebook-status" class="status">Ready to search...</div>
		<div id="facebook-selected" class="selected-info" style="display: none;">
			<h4>Selected Category:</h4>
			<p><strong>ID:</strong> <span class="category-id"></span></p>
			<p><strong>Name:</strong> <span class="category-name"></span></p>
			<p><strong>Full Path:</strong><br><span class="category-path"></span></p>

			<h4>Schema.org Microdata:</h4>
			<pre class="schema-microdata" style="background: #f5f5f5; padding: 0.5rem; overflow-x: auto; font-size: 0.75rem;"></pre>

			<h4>Schema.org JSON-LD:</h4>
			<pre class="schema-jsonld" style="background: #f5f5f5; padding: 0.5rem; overflow-x: auto; font-size: 0.75rem;"></pre>
		</div>
	</section>

	<section class="demo-section">
		<h3>Custom Data Source</h3>
		<p>You can also specify a custom data file using the <code>data</code> attribute:</p>
		<pre><code>&lt;product-taxonomy
  data="path/to/taxonomy.txt"
  mode="google"
  label="Custom Taxonomy"&gt;
&lt;/product-taxonomy&gt;</code></pre>
	</section>

	<h2>Attributes</h2>
	<ul>
		<li><code>mode</code> or <code>type</code>: Either "google" or "facebook" (default: "google")</li>
		<li><code>data</code>: Custom path to taxonomy file (overrides mode default)</li>
		<li><code>label</code>: Label text for the input field</li>
		<li><code>placeholder</code>: Placeholder text</li>
		<li><code>minlength</code>: Minimum characters before search (default: 2)</li>
		<li><code>max-results</code>: Maximum number of results to show (default: 50)</li>
		<li><code>list-mode</code>: Either "datalist" or "ul" (default: "datalist")</li>
		<li><code>noshadow</code>: Render without shadow DOM</li>
		<li><code>required</code>: Make the field required</li>
	</ul>

	<h2>Events</h2>
	<ul>
		<li><code>taxonomyLoadStart</code>: Fired when taxonomy data loading begins</li>
		<li><code>taxonomyLoadEnd</code>: Fired when loading completes (detail: {count})</li>
		<li><code>taxonomyLoadError</code>: Fired on loading error</li>
		<li><code>taxonomySearchStart</code>: Fired when search begins</li>
		<li><code>taxonomySearchEnd</code>: Fired when search completes (detail: {count})</li>
		<li><code>taxonomySelect</code>: Fired when a category is selected (detail: taxonomy item)</li>
		<li><code>taxonomyClear</code>: Fired when selection is cleared</li>
	</ul>

	<h2>API</h2>
	<ul>
		<li><code>selectedItem</code>: Get currently selected taxonomy item</li>
		<li><code>setValue(id, display)</code>: Set value programmatically</li>
		<li><code>search(query)</code>: Search taxonomy data</li>
	</ul>

	<script type="module">
		import { ProductTaxonomy } from './index.js';
		import { AutoSuggest } from '../auto-suggest/index.js';

		/**
		 * Generates Schema.org Microdata for a product category.
		 * Uses the DefinedTerm schema for product categories.
		 * @param {object} item - The selected taxonomy item.
		 * @returns {string} HTML string for the microdata.
		 */
		function generateMicrodata(item) {
			const categories = item.categories;
			// Helper to escape HTML entities
			const escape = (str) => str.replace(/</g, '&lt;').replace(/>/g, '&gt;');

			let boilerplate = `<span class="schema-boilerplate">${escape('<div itemscope itemtype="https://schema.org/Product">')}\n`;
			boilerplate += `  ${escape('<meta itemprop="name" content="Example Product">')}</span>\n`;

			let taxonomyHtml = `  ${escape('<div itemprop="category" itemscope itemtype="https://schema.org/DefinedTerm">')}\n`;
			taxonomyHtml += `    ${escape(`<meta itemprop="termCode" content="${item.id}">`)}\n`;
			taxonomyHtml += `    ${escape(`<meta itemprop="name" content="${item.name}">`)}\n`;

			// Add hierarchical categories using inDefinedTermSet
			if (categories.length > 1) {
				taxonomyHtml += `    ${escape('<div itemprop="inDefinedTermSet" itemscope itemtype="https://schema.org/DefinedTermSet">')}\n`;
				taxonomyHtml += `      ${escape(`<meta itemprop="name" content="${categories.slice(0, -1).join(' > ')}">`)}\n`;
				taxonomyHtml += `    ${escape('</div>')}\n`;
			}

			taxonomyHtml += `  ${escape('</div>')}\n`;
			taxonomyHtml += `<span class="schema-boilerplate">${escape('</div>')}</span>`;

			return boilerplate + taxonomyHtml;
		}

		/**
		 * Generates Schema.org JSON-LD for a product category.
		 * @param {object} item - The selected taxonomy item.
		 * @returns {string} JSON-LD string.
		 */
		function generateJsonLd(item) {
			const jsonld = {
				"@context": "https://schema.org",
				"@type": "Product",
				"name": "Example Product",
				"category": {
					"@type": "DefinedTerm",
					"termCode": item.id,
					"name": item.name,
					"inDefinedTermSet": {
						"@type": "DefinedTermSet",
						"name": "Google Product Taxonomy" // Assuming a default, can be adapted
					},
					"additionalProperty": {
						"@type": "PropertyValue",
						"name": "categoryPath",
						"value": item.path
					}
				}
			};

			// Add hierarchical categories
			if (item.categories.length > 1) {
				jsonld.category.inDefinedTermSet.name = item.categories.slice(0, -1).join(' > ');
			}

			return JSON.stringify(jsonld, null, 2);
		}

		/**
		 * Sets up event listeners and UI updates for a product-taxonomy instance.
		 * @param {string} id - The ID of the product-taxonomy element.
		 */
		function setupTaxonomyComponent(id) {
			const taxonomyEl = document.getElementById(id);
			if (!taxonomyEl) return;

			const prefix = id.replace('-taxonomy', '');
			const elements = {
				status: document.getElementById(`${prefix}-status`),
				selected: document.getElementById(`${prefix}-selected`),
				categoryId: document.querySelector(`#${prefix}-selected .category-id`),
				categoryName: document.querySelector(`#${prefix}-selected .category-name`),
				categoryPath: document.querySelector(`#${prefix}-selected .category-path`),
				schemaMicrodata: document.querySelector(`#${prefix}-selected .schema-microdata`),
				schemaJsonld: document.querySelector(`#${prefix}-selected .schema-jsonld`),
			};

			taxonomyEl.addEventListener('taxonomyLoadStart', () => {
				elements.status.textContent = `Loading ${taxonomyEl.mode} taxonomy data...`;
				elements.status.style.background = '#f0f0f0';
			});

			taxonomyEl.addEventListener('taxonomyLoadEnd', (e) => {
				elements.status.textContent = `Loaded ${e.detail.count} categories. Ready to search!`;
			});

			taxonomyEl.addEventListener('taxonomyLoadError', (e) => {
				elements.status.textContent = `Error: ${e.detail.message}`;
				elements.status.style.background = '#ffebee';
			});

			taxonomyEl.addEventListener('taxonomySearchEnd', (e) => {
				elements.status.textContent = `Found ${e.detail.count} matching categories`;
			});

			taxonomyEl.addEventListener('taxonomySelect', () => {
				const item = taxonomyEl.selectedItem;
				if (item) {
					elements.selected.style.display = 'block';
					elements.categoryId.textContent = item.id;
					elements.categoryName.textContent = item.name;
					elements.categoryPath.textContent = item.path;
					elements.schemaMicrodata.innerHTML = generateMicrodata(item);
					elements.schemaJsonld.textContent = generateJsonLd(item);
				}
			});

			taxonomyEl.addEventListener('taxonomyClear', () => {
				elements.selected.style.display = 'none';
				elements.status.textContent = 'Selection cleared. Ready to search...';
			});
		}

		// Setup both taxonomy components
		setupTaxonomyComponent('google-taxonomy');
		setupTaxonomyComponent('facebook-taxonomy');
	</script>
</body>
</html>