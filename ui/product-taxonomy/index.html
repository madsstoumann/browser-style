<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Product Taxonomy</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Product Taxonomy Component - Search Google and Facebook product categories">
	<meta name="view-transition" content="same-origin">
	<link rel="stylesheet" href="/ui/base/index.css">
</head>
<body>
	<h1>UI: Product Taxonomy</h1>

	<p>
		The <code>&lt;product-taxonomy&gt;</code> component integrates with <code>&lt;auto-suggest&gt;</code>
		to provide searchable product category selection from Google or Facebook taxonomies.
	</p>

	<h2>Examples</h2>

	<section>
		<h3>Google Product Taxonomy</h3>
		<p>Search for product categories like "headphones", "shoes", "furniture", etc.</p>

		<product-taxonomy
			id="google-taxonomy"
			data="google.txt"
			schema="microdata json"
			label="Google Product Category"
			list-mode="ul"
			placeholder="e.g., headphones, coffee, toys"
			noshadow>
			<small slot="info"></small>
			<small slot="status"></small>
		</product-taxonomy>
	</section>

	<section>
		<h3>Facebook Product Taxonomy</h3>
		<p>Search Facebook's product categories. Try "beverages", "toys", "furniture".</p>

		<product-taxonomy
			id="facebook-taxonomy"
			data="facebook.txt"
			schema="json"
			label="Facebook Product Category"
			placeholder="e.g., food, games, clothing"
			list-mode="ul"
			noshadow>
			<small slot="info"></small>
			<small slot="status"></small>
		</product-taxonomy>
	</section>

	<section>
		<h3>Google Product Taxonomy with Fuzzy Search</h3>
		<p>Fuzzy search with typo tolerance. Try typos like "coffe cups", "headphnes", "furnitur".</p>
		<p><strong>Features:</strong> Tolerates spelling mistakes, finds similar words, ranks by relevance.</p>

		<auto-suggest
			id="fuzzy-taxonomy"
			api="google.txt"
			search-mode="local-fuzzy"
			search-fields="path"
			min-score="0.5"
			max-results="20"
			api-value-path="id"
			api-display-path="path"
			info-template="Loaded {count} categories"
			label="Fuzzy Product Search"
			list-mode="ul"
			minlength="3"
			placeholder="e.g., coffe, hphone, furnitur"
			noshadow
		>
			<small slot="info"></small>
			<small slot="status"></small>
		</auto-suggest>
	</section>

	<h2>Documentation</h2>
	<p>For full documentation including attributes, properties, events, slots, and API methods, see the <a href="https://github.com/madsstoumann/browser-style/tree/main/ui/product-taxonomy">README</a>.</p>

	<script type="module">
		import {
			ProductTaxonomy,
			googleTaxonomyParser,
			facebookTaxonomyParser,
		} from './index.js';
		import { AutoSuggest } from '../auto-suggest/index.js';

		/**
		 * Sets up event listeners for a product-taxonomy instance.
		 * @param {string} id - The ID of the product-taxonomy element.
		 * @param {function} parser - The parser function to use for this instance.
		 */
		function setupTaxonomyComponent(id, parser) {
			const taxonomyEl = document.getElementById(id);
			if (!taxonomyEl) return;

			// Assign the parser
			taxonomyEl.parser = parser;

			// Log selection events for debugging
			taxonomyEl.addEventListener('taxonomySelect', (e) => {
				console.log(`${id} selected:`, e.detail);
			});

			taxonomyEl.addEventListener('taxonomyClear', () => {
				console.log(`${id} cleared`);
			});
		}

		// Setup both taxonomy components with their respective parsers
		setupTaxonomyComponent('google-taxonomy', googleTaxonomyParser);
		setupTaxonomyComponent('facebook-taxonomy', facebookTaxonomyParser);

		// Setup fuzzy search demo
		const fuzzyEl = document.getElementById('fuzzy-taxonomy');

		if (fuzzyEl) {
			// Parse Google taxonomy data for fuzzy search
			fetch(new URL('google.txt', import.meta.url))
				.then(response => response.text())
				.then(text => {
					const lines = text.split('\n').filter(line => line.trim() && !line.startsWith('#'));
					const parsed = lines.map(line => {
						const item = googleTaxonomyParser(line);
						if (item) {
							return {
								id: item.id,
								path: item.path,
								_searchText: item.path.toLowerCase()
							};
						}
						return null;
					}).filter(Boolean);

					fuzzyEl.fullDataset = parsed;
				});

			fuzzyEl.addEventListener('autoSuggestSelect', (e) => {
				console.log('Fuzzy search selected:', e.detail);
			});
		}
	</script>
</body>
</html>