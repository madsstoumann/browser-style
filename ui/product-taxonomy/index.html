<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Product Taxonomy</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Product Taxonomy Component - Search Google and Facebook product categories">
	<meta name="view-transition" content="same-origin">
	<link rel="stylesheet" href="/ui/base/index.css">
</head>
<body>
	<h1>UI: Product Taxonomy</h1>

	<p>
		The <code>&lt;product-taxonomy&gt;</code> component integrates with <code>&lt;auto-suggest&gt;</code>
		to provide searchable product category selection from Google or Facebook taxonomies.
	</p>

	<h2>Examples</h2>

	<section>
		<h3>Google Product Taxonomy</h3>
		<p>Search for product categories like "headphones", "shoes", "furniture", etc.</p>

		<product-taxonomy
			id="google-taxonomy"
			data="google.txt"
			schema="microdata json"
			label="Google Product Category"
			list-mode="ul"
			placeholder="e.g., headphones, coffee, toys"
			noshadow
		></product-taxonomy>

		<small id="google-status"></small>
	</section>

	<section>
		<h3>Facebook Product Taxonomy</h3>
		<p>Search Facebook's product categories. Try "beverages", "toys", "furniture".</p>

		<product-taxonomy
			id="facebook-taxonomy"
			data="facebook.txt"
			schema="json"
			label="Facebook Product Category"
			placeholder="e.g., food, games, clothing"
			list-mode="ul"
			noshadow
		></product-taxonomy>

		<small id="facebook-status"></small>
	</section>

	<h2>Attributes</h2>
	<ul>
		<li><code>data</code>: (Required) Path to the taxonomy text file.</li>
		<li><code>schema</code>: Space-separated values. Include "microdata" or "json" to show schema previews.</li>
		<li><code>label</code>: Label text for the input field.</li>
		<li><code>placeholder</code>: Placeholder text.</li>
		<li><code>minlength</code>: Minimum characters before search (default: 2).</li>
		<li><code>max-results</code>: Maximum number of results to show (default: 50).</li>
		<li><code>list-mode</code>: Either "datalist" or "ul" (default: "datalist").</li>
		<li><code>noshadow</code>: Render without shadow DOM.</li>
		<li><code>required</code>: Make the field required.</li>
	</ul>

	<h2>Properties</h2>
	<ul>
		<li><code>parser</code>: A JavaScript function that takes a string (a line from the data file) and returns a structured object: <code>{ id, name, path, categories }</code>. Defaults to <code>googleTaxonomyParser</code>.</li>
	</ul>

	<h2>Events</h2>
	<ul>
		<li><code>taxonomyLoadStart</code>: Fired when taxonomy data loading begins.</li>
		<li><code>taxonomyLoadEnd</code>: Fired when loading completes (detail: {count}).</li>
		<li><code>taxonomyLoadError</code>: Fired on loading error.</li>
		<li><code>taxonomySearchStart</code>: Fired when search begins.</li>
		<li><code>taxonomySearchEnd</code>: Fired when search completes (detail: {count}).</li>
		<li><code>taxonomySelect</code>: Fired when a category is selected (detail: taxonomy item).</li>
		<li><code>taxonomyClear</code>: Fired when selection is cleared.</li>
	</ul>

	<h2>API</h2>
	<ul>
		<li><code>selectedItem</code>: Get currently selected taxonomy item.</li>
		<li><code>setValue(id, display)</code>: Set value programmatically.</li>
		<li><code>search(query)</code>: Search taxonomy data.</li>
	</ul>

	<script type="module">
		import {
			ProductTaxonomy,
			googleTaxonomyParser,
			facebookTaxonomyParser,
		} from './index.js';

		/**
		 * Sets up event listeners and UI updates for a product-taxonomy instance.
		 * @param {string} id - The ID of the product-taxonomy element.
		 * @param {function} parser - The parser function to use for this instance.
		 */
		function setupTaxonomyComponent(id, parser) {
			const taxonomyEl = document.getElementById(id);
			if (!taxonomyEl) return;

			// Assign the parser
			taxonomyEl.parser = parser;

			const prefix = id.replace('-taxonomy', '');
			const statusEl = document.getElementById(`${prefix}-status`);

			taxonomyEl.addEventListener('taxonomyLoadStart', () => {
				statusEl.textContent = `Loading taxonomy data...`;
			});

			taxonomyEl.addEventListener('taxonomyLoadEnd', (e) => {
				statusEl.textContent = `Loaded ${e.detail.count} categories.`;
			});

			taxonomyEl.addEventListener('taxonomyLoadError', (e) => {
				statusEl.textContent = `Error: ${e.detail.message}`;
				statusEl.style.background = '#ffebee';
			});

			taxonomyEl.addEventListener('taxonomySearchEnd', (e) => {
				statusEl.textContent = `Found ${e.detail.count} matching categories`;
			});

			taxonomyEl.addEventListener('taxonomySelect', (e) => {
				console.log(`${prefix} taxonomy selected:`, e.detail);
				statusEl.textContent = 'Category selected.';
			});

			taxonomyEl.addEventListener('taxonomyClear', () => {
				statusEl.textContent = 'Selection cleared. Ready to search...';
			});
		}

		// Setup both taxonomy components with their respective parsers
		setupTaxonomyComponent('google-taxonomy', googleTaxonomyParser);
		setupTaxonomyComponent('facebook-taxonomy', facebookTaxonomyParser);
	</script>
</body>
</html>